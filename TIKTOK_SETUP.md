# Настройка TikTok API

## Обзор

Этот документ содержит инструкции по настройке TikTok API для интеграции с приложением. Мы используем TikTok Open API v2 с PKCE (Proof Key for Code Exchange) для безопасной OAuth авторизации.

## Шаги настройки

### 1. Создание приложения в TikTok Developer Console

1. Перейдите на [TikTok for Developers](https://developers.tiktok.com/)
2. Войдите в свой аккаунт TikTok
3. Нажмите "Create App"
4. Заполните форму:
   - **App Name**: Название вашего приложения
   - **App Description**: Описание функциональности
   - **Platform**: Web
   - **Category**: Выберите подходящую категорию

### 2. Настройка OAuth

1. В настройках приложения перейдите в раздел "OAuth"
2. Добавьте Redirect URI:
   ```
   http://localhost:3000/api/auth/tiktok/callback
   ```
   Для продакшена замените на ваш домен:
   ```
   https://yourdomain.com/api/auth/tiktok/callback
   ```

### 3. Получение ключей

1. В настройках приложения найдите раздел "App Info"
2. Скопируйте:
   - **Client Key** (Client ID)
   - **Client Secret**

### 4. Настройка переменных окружения

Создайте или обновите файл `.env.local`:

```env
# TikTok API
NEXT_PUBLIC_TIKTOK_CLIENT_KEY=your_client_key_here
TIKTOK_CLIENT_SECRET=your_client_secret_here
NEXT_PUBLIC_TIKTOK_REDIRECT_URI=http://localhost:3000/api/auth/tiktok/callback
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

Для продакшена:
```env
NEXT_PUBLIC_TIKTOK_CLIENT_KEY=your_client_key_here
TIKTOK_CLIENT_SECRET=your_client_secret_here
NEXT_PUBLIC_TIKTOK_REDIRECT_URI=https://yourdomain.com/api/auth/tiktok/callback
NEXT_PUBLIC_APP_URL=https://yourdomain.com
```

### 5. Настройка разрешений

В настройках приложения убедитесь, что включены следующие разрешения:
- `user.info.basic` - доступ к базовой информации пользователя
- `video.list` - доступ к списку видео пользователя

## Безопасность PKCE

Приложение использует PKCE (Proof Key for Code Exchange) для дополнительной безопасности OAuth потока:

1. **Code Verifier**: Генерируется случайная строка на клиенте
2. **Code Challenge**: SHA-256 хеш от code verifier
3. **Обмен токена**: code verifier отправляется вместе с кодом авторизации

Это предотвращает атаки типа "authorization code interception".

## Функциональность

После настройки пользователи смогут:

### Подключение аккаунта
- Авторизоваться через TikTok OAuth с PKCE
- Предоставить доступ к публичным данным
- Безопасное хранение токенов

### Просмотр статистики
- **Профиль**: отображение имени, аватара, описания
- **Подписчики**: количество подписчиков и подписок
- **Видео**: общее количество видео
- **Вовлеченность**: общие лайки, комментарии, просмотры

### Аналитика видео
- Список последних видео с превью
- Статистика каждого видео:
  - Количество лайков
  - Количество комментариев
  - Количество просмотров
  - Количество репостов
- Средние показатели по всем видео
- Уровень вовлеченности

### Детальный просмотр
- Модальные окна с подробной информацией о видео
- Ссылки для просмотра на TikTok
- Длительность видео
- Дата публикации

## Безопасность

- Приложение получает доступ только к публичным данным
- Используется PKCE для безопасной OAuth авторизации
- Токены хранятся в localStorage браузера
- Поддерживается автоматическое обновление токенов
- Возможность отключения аккаунта

## Ограничения API

- **Rate Limits**: TikTok API имеет ограничения на количество запросов
- **Данные**: Доступ только к публичным видео и профилю
- **Обновления**: Данные обновляются при каждом посещении страницы

## Устранение неполадок

### Ошибка code_challenge
- Убедитесь, что приложение использует PKCE
- Проверьте правильность генерации code_verifier и code_challenge
- Проверьте, что code_challenge_method установлен в 'S256'

### Ошибка авторизации
- Проверьте правильность Client Key и Client Secret
- Убедитесь, что Redirect URI настроен корректно
- Проверьте, что приложение одобрено TikTok

### Ошибки загрузки данных
- Проверьте срок действия токена
- Убедитесь, что у пользователя есть публичные видео
- Проверьте сетевое подключение

### Проблемы с отображением
- Очистите кэш браузера
- Проверьте консоль на наличие ошибок JavaScript
- Убедитесь, что все компоненты загружены корректно

## Поддержка

При возникновении проблем:
1. Проверьте логи в консоли браузера
2. Убедитесь в правильности настройки переменных окружения
3. Проверьте статус TikTok API на [developers.tiktok.com](https://developers.tiktok.com/)
4. Обратитесь к документации TikTok Open API v2 